(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var o in a)e.o(a,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:a[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,a=window.React;var o=e.n(a);const n=window.ReactDOM;var r=e.n(n);const s=window.wp.i18n,m=({setStep:e})=>(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",null,(0,s.__)("After setup, Imageshop will become your one source of truth for all media on your site.","imageshop-dam-connector")),(0,t.createElement)("div",{className:"imageshop-modal-actions"},(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>e(2)},(0,s.__)("Start setup","imageshop-dam-connector")),(0,t.createElement)("a",{href:"https://imageshop.no",className:"pull-right",target:"_blank",rel:"noopener noreferrer"},(0,s.__)("Create an account","imageshop-dam-connector")))),l=window.wp.apiFetch;var c=e.n(l);const i=({setStep:e})=>{const[o,n]=(0,a.useState)(""),[r,m]=(0,a.useState)(!1),[l,i]=(0,a.useState)("");return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",null,(0,s.__)("Enter your API token here. You can find your API token in your ImageShop account.","imageshop-dam-connector")),l&&(0,t.createElement)(t.Fragment,null,r&&(0,t.createElement)("p",{className:"valid-token"},(0,s.__)("✔ Your API token is valid.","imageshop-dam-connector")),!r&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",{className:"invalid-token"},(0,s.__)("❌ Your API token is invalid:","imageshop-dam-connector")),(0,t.createElement)("p",{className:"invalid-token"},l))),(0,t.createElement)("input",{type:"text",value:o,onChange:e=>n(e.target.value)}),(0,t.createElement)("div",{className:"imageshop-modal-actions"},!r&&(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>{c()({path:"/imageshop/v1/onboarding/token",method:"POST",data:{token:o}}).then((e=>{m(e.valid),i(e.message)})).catch((e=>{m(e.valid),i(e.message)}))}},(0,s.__)("Test API token","imageshop-dam-connector")),r&&(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>e(3)},(0,s.__)("Continue to upload settings","imageshop-dam-connector"))))},p=window.wp.components,u=({setStep:e})=>{const[o,n]=(0,t.useState)(),[r,m]=(0,t.useState)([]);return(0,a.useEffect)((()=>{c()({path:"/imageshop/v1/onboarding/interfaces"}).then((e=>{const t=[];t.push({value:"",label:(0,s.__)("Select an interface","imageshop-dam-connector")}),e.interfaces.map((e=>{const a={value:e.Id,label:e.Name};t.push(a)})),m(t)}))}),[]),(0,a.useEffect)((()=>{o&&c()({path:"/imageshop/v1/onboarding/interfaces",method:"POST",data:{interface:o}})}),[o]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",null,(0,s.__)("Interfaces determine where files are stored in your Imageshop account.","imageshop-dam-connector")),(0,t.createElement)(p.SelectControl,{label:(0,s.__)("Select which interface is used for uploaded media files","imageshop-dam-connector"),options:r,onChange:e=>n(e)}),(0,t.createElement)("div",{className:"imageshop-modal-actions"},o&&(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>e(4)},(0,s.__)("Continue to imports","imageshop-dam-connector"))))},d=({setStep:e})=>{const[o,n]=(0,a.useReducer)(((e,t)=>({...e,...t})),{progressImported:0,progressTotal:0,doingImport:!1}),{progressImported:r,progressTotal:m,doingImport:l}=o;let i;const p=()=>{clearTimeout(i),c()({path:"/imageshop/v1/onboarding/completed"}).then((()=>{e(5)}))},u=()=>{c()({path:"/imageshop/v1/onboarding/import",method:"GET"}).then((e=>{n({progressImported:e.imported,progressTotal:e.total}),i=setTimeout(u,5e3)}))};return(0,a.useEffect)((()=>{m<=0||m===r&&p()}),[m,r]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",null,(0,s.__)("Would you like to import your current Wordpress media library to Imageshop? This would make your media be available both in Imageshop and in the Imageshop plugin.","imageshop-dam-connector")),(0,t.createElement)("p",null,(0,s.__)("WARNING: Such an import may take quite a long time to complete, and is not required for your existing media to keep showing as usual. You should only perform an import if you know that you need existing media to be available in Imageshop as well.","imageshop-dam-connector")),l&&(0,t.createElement)("div",{className:"imageshop-import-progress-indicator"},(0,t.createElement)("label",{htmlFor:"imageshop-import-progress"},(0,s.__)("Import Progress","imageshop-dam-connector")),(0,t.createElement)("progress",{id:"imageshop-import-progress",value:r,max:m})),(0,t.createElement)("div",{className:"imageshop-modal-actions"},(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>p(),disabled:l},(0,s.__)("Continue without importing media","imageshop-dam-connector")),(0,t.createElement)("button",{type:"button",className:"button button-link button-link-delete",onClick:()=>(n({doingImport:!0}),void c()({path:"/imageshop/v1/onboarding/import",method:"POST"}).then((e=>{u()}))),disabled:l},(0,s.__)("Import existing media","imageshop-dam-connector"))))},h=({setShowWizard:e,setShowNotice:a})=>(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",null,(0,s.__)("Your site has now been configured to use all media via Imageshop.","imageshop-dam-connector")),(0,t.createElement)("div",{className:"imageshop-modal-actions"},(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>(a(!1),void e(!1))},(0,s.__)("Finish setup","imageshop-dam-connector")))),g=({setShowWizard:e,setShowNotice:o})=>{const[n,r]=(0,a.useState)(1);return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:"imageshop-modal-overlay"},(0,t.createElement)("div",{className:"imageshop-wizard-wrapper"},(0,t.createElement)("dialog",{className:"imageshop-wizard"},(0,t.createElement)("div",{className:"imageshop-modal-header"},(0,t.createElement)("h2",null,(0,s.__)("Imageshop setup","imageshop-dam-connector")),(0,t.createElement)("button",{type:"button",className:"imageshop-modal-close",onClick:()=>e(!1)},(0,t.createElement)("span",{className:"dashicons dashicons-no"}),(0,t.createElement)("span",{className:"screen-reader-text"},(0,s.__)("Close Imageshop setup modal","imageshop-dam-connector")))),(0,t.createElement)("div",{className:"imageshop-modal-body"},1===n&&(0,t.createElement)(m,{setStep:r}),2===n&&(0,t.createElement)(i,{setStep:r}),3===n&&(0,t.createElement)(u,{setStep:r}),4===n&&(0,t.createElement)(d,{setStep:r}),5===n&&(0,t.createElement)(h,{setShowNotice:o,setShowWizard:e}))))))},E=()=>{const[e,o]=(0,a.useState)(!0),[n,r]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{window.addEventListener("keydown",(e=>{"Escape"===e.key&&r(!1)}))}),[]),(0,a.useEffect)((()=>{const e=document.querySelector("body");n?e.classList.add("disable-scroll"):e.classList.remove("disable-scroll")}),[n]),e?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:"notice notice-warning inline"},(0,t.createElement)("h2",null,(0,s.__)("Imageshop setup","imageshop-dam-connector")),(0,t.createElement)("p",null,(0,s.__)("The Imageshop integration is almost ready to use, please complete the setup steps to start using Imageshop directly from your media library.","imageshop-dam-connector")),(0,t.createElement)("p",null,(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>r(!0)},(0,s.__)("Complete setup","imageshop-dam-connector")))),n&&(0,t.createElement)(g,{setShowWizard:r,setShowNotice:o})):(0,t.createElement)(t.Fragment,null)},b=document.getElementById("imageshop-onboarding");b&&r().render((0,t.createElement)(o().StrictMode,null,(0,t.createElement)((()=>(0,t.createElement)(t.Fragment,null,(0,t.createElement)(E,null))),null)),b)})();